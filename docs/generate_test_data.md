# Shell Test Data Generator (generate_test_data.sh)

## **🎯 Purpose**

The `generate_test_data.sh` is a shell-based alternative to `test_data_generator.py` that generates realistic IoT telemetry data using the gcloud CLI. It serves as a **reliable workaround** for Python 3.13 compatibility issues while providing the same data generation capabilities.

## **📊 Data Generation Flow**
```
Shell Script → Random Data Generation → JSON Message → gcloud CLI → Pub/Sub Topic
```

## **🛠️ Technical Approach**

### **Why Shell-Based?**
- **Bypasses Python 3.13 issues** - Uses gcloud CLI which has no compatibility problems
- **No hanging timeouts** - Direct CLI publishing is reliable
- **Immediate execution** - Completes quickly without client library overhead
- **Dependency-free** - Only requires gcloud CLI (already installed)

### **Core Technologies**
```bash
#!/bin/bash
gcloud pubsub topics publish    # Direct Pub/Sub publishing
bc -l                          # Floating-point arithmetic for coordinates
date -u                        # UTC timestamp generation
$RANDOM                        # Built-in random number generation
```

## **🚗 Fleet Simulation**

### **Vehicle Fleet**
```bash
VEHICLES=("VH001" "VH002" "VH003" "VH004" "VH005")
DEVICE_TYPES=("gps_tracker" "obd_device" "fuel_sensor")
ENGINE_STATUS=("running" "idle" "off")
```

### **Geographic Distribution**
- **Base coordinates**: Chicago area (41.8781, -87.6298)
- **Random movement**: ±0.1 degree radius using `bc` calculations
- **Realistic spread**: Simulates vehicles across metropolitan area

### **Data Realism**
```bash
SPEED=$((RANDOM % 120))         # 0-120 km/h
FUEL=$((RANDOM % 100))          # 0-100% fuel level
TEMP=$((RANDOM % 40 - 10))      # -10 to 30°C temperature
ODOMETER=$((50000 + RANDOM % 150000))  # Realistic mileage
```

## **📡 Message Structure**

### **JSON Schema generated by `generate_test_data.sh` for Pub/Sub topic `iot-telemetry`**
```json
{
    "vehicle_id": "VH003",
    "device_type": "gps_tracker",
    "timestamp": "2025-10-02T01:55:56Z",
    "latitude": 41.8891,
    "longitude": -87.6198,
    "speed_kmh": 87,
    "fuel_level": 72,
    "engine_status": "running",
    "driver_id": "DR007",
    "route_id": "RT014",
    "odometer": 125847,
    "temperature": 18,
    "generated_at": "2025-10-02T01:55:56Z",
    "data_source": "shell_script"
}
```

### **Unique Fields**
- **`data_source`**: "shell_script" - identifies origin
- **Consistent timestamps** - same value for `timestamp` and `generated_at`
- **Random route/driver IDs** - RT001-RT020, DR001-DR010

## **⚡ Usage & Performance**

### **Basic Execution**
```bash
./generate_test_data.sh 5       # Generate 5 messages
./generate_test_data.sh         # Default 5 messages
```

### **Performance Characteristics**
- **Execution time**: ~3-5 seconds for 5 messages
- **Message interval**: 0.5 seconds between publishes
- **No timeouts**: Completes reliably every time
- **Immediate feedback**: Shows publish status for each message

### **Output Example**
```
🚀 Generating 5 test messages using gcloud CLI...
📍 Project: manish-sandpit
📡 Topic: iot-telemetry

📤 Publishing message 1 for vehicle VH003...
messageIds:
- '8712394857123'
✅ Message 1 published successfully

🎉 Completed generating 5 test messages
📊 Check with: gcloud pubsub subscriptions pull iot-telemetry-subscription --limit=3 --auto-ack
```

## **🔧 Implementation Details**

### **Random Data Generation**
```bash
# Random selections from arrays
VEHICLE=${VEHICLES[$((RANDOM % ${#VEHICLES[@]}))]}
DEVICE=${DEVICE_TYPES[$((RANDOM % ${#DEVICE_TYPES[@]}))]}

# Floating-point coordinate calculation
LAT=$(echo "41.8781 + ($RANDOM % 200 - 100) * 0.001" | bc -l)
LON=$(echo "-87.6298 + ($RANDOM % 200 - 100) * 0.001" | bc -l)
```

### **JSON Construction**
```bash
MESSAGE=$(cat <<EOF
{
    "vehicle_id": "$VEHICLE",
    "device_type": "$DEVICE",
    "timestamp": "$TIMESTAMP",
    ...
}
EOF
)
```

### **Publishing Method**
```bash
echo "$MESSAGE" | gcloud pubsub topics publish $TOPIC --message=-
```

## **✅ Advantages Over Python Version**

### **Reliability**
- **No hanging** - Always completes execution
- **No timeouts** - Direct CLI publishing works consistently
- **No dependency issues** - Uses standard shell and gcloud
- **Predictable execution time** - Always ~3-5 seconds

### **Simplicity**
- **Single file** - No virtual environments or pip installs
- **Readable code** - Easy to modify and understand
- **Shell-native** - Works in any Unix/Linux/macOS environment
- **Debugging friendly** - Clear error messages and status output

### **Maintenance**
- **No library updates** - gcloud CLI is maintained by Google
- **Cross-platform** - Works wherever gcloud works
- **Version independent** - No Python version conflicts
- **Production ready** - Can be used in CI/CD pipelines

## **📊 Verification & Monitoring**

### **Success Indicators**
```bash
✅ Message 1 published successfully    # Successful publish
messageIds: ['8712394857123']         # Message ID returned
🎉 Completed generating X messages    # All messages sent
```

### **Validation Command**
```bash
gcloud pubsub subscriptions pull iot-telemetry-subscription --limit=3 --auto-ack
```

### **Expected Results**
- **ACK_STATUS**: SUCCESS for all messages
- **Message content**: Valid JSON with all expected fields
- **Timestamps**: Proper UTC format
- **Data source**: "shell_script" identifier

## **💼 Business Value**

### **Development Reliability**
- **Consistent testing** - No random failures due to client issues
- **CI/CD integration** - Can be used in automated testing pipelines
- **Debugging support** - Clear, immediate feedback on publish status
- **Cross-team usage** - Works for non-Python developers

### **Cost Efficiency**
- **No compute overhead** - Minimal resource usage
- **Fast execution** - Reduces development iteration time
- **Reliable scaling** - Can generate thousands of messages reliably
- **Infrastructure independent** - No special environment setup

### **Risk Mitigation**
- **Backup solution** - Alternative when Python client fails
- **Production fallback** - Can be used for emergency data generation
- **Documentation** - Serves as CLI reference for Pub/Sub operations

## **🔄 Integration Points**

### **Upstream Dependencies**
- **gcloud CLI** - Must be installed and authenticated
- **Pub/Sub topic** - Target topic must exist
- **Bash environment** - Standard Unix shell required
- **bc calculator** - For floating-point arithmetic

### **Downstream Integration**
- **Same data format** - Compatible with `basic_pipeline.py`
- **Same Pub/Sub topic** - Uses `iot-telemetry` topic
- **Monitoring compatibility** - Shows up in same dashboards
- **Testing equivalence** - Produces equivalent test data

### **Use Cases**
- **Python issues** - When `test_data_generator.py` has problems
- **CI/CD pipelines** - Automated testing in build systems
- **Quick testing** - Fast data generation for immediate needs
- **Production debugging** - Emergency data injection

## **🚀 Future Enhancements**

### **Planned Features**
- **Configurable patterns** - Command-line options for data patterns
- **Multi-topic support** - Send to different topics based on device type
- **Batch optimization** - Reduce gcloud CLI overhead for large volumes
- **Error injection** - Simulate malformed data for testing

### **Advanced Capabilities**
- **Time-series generation** - Historical data with proper time spacing
- **Route simulation** - GPS tracks between realistic points
- **Load testing mode** - High-volume generation with parallel processes
- **Integration scripts** - Combine with pipeline deployment and testing

This shell-based generator is the **reliable foundation** for testing and development when Python client libraries have compatibility issues, ensuring consistent data generation capabilities.